#!/usr/bin/env python
from video_helpers import Video
import argparse
from scipy.misc import imsave
import cv2 as cv
from joblib import Parallel, delayed

def convert_color(image):
    return cv.cvtColor(image, cv.COLOR_BGR2RGB)


def extract_frames(video, ouput_pattern, amount, step):

    total = amount * step

    with Video(video, mode='read') as video:

        for frame_num in range(1, total, step):
            video.seek(frame_num)
            frame = convert_color(video.read())
            filename = ouput_pattern.format(frame=frame_num)
            imsave(filename, frame)

if __name__ == '__main__':

    parser = argparse.ArgumentParser()
    parser.add_argument('--video', required=True)
    parser.add_argument('--output', required=True)
    parser.add_argument('--amount', required=True)
    parser.add_argument('--step', required=True)

    arguments = parser.parse_args()

    extract_frames(
        arguments.video,
        arguments.output,
        int(arguments.amount),
        int(arguments.step)
    )